 param (
    [string]$env="dev",    
    [string]$filePaths ="d:\temp\zz.java",
    [string]$baseDir
 )

#region 1. comment/uncomment java code
Class RegionItem
{
    [int]$pos
    [int]$posType #0:begin, 1:end, //region //ednregion
    [int]$action #0:add, 1:remove
}

$debug=$false

$files = $filePaths.split(",");

Foreach($filePath in $files){
    Write-Host "----- Change Java Code ----"
    Write-Host "-- File: $filePath --"
    $filePath = $baseDir + "\src\main\java\" + $filePath
    $fullText = Get-Content -path "$filePath" -encoding utf8
    $find=$false
    $posList=@()
    $result=@()
    $currentAction=0

    For($i=0; $i -lt $fullText.Length; $i++)
    {    
        $item = $fullText[$i].Trim().Replace("`t", "")
        if($item.StartsWith("//region "))
        {
            #Write-Host "found BEGIN [$i]: $item"
            if($item -eq "//region " + $env){
                if($fullText[$i+1].Trim() -eq "/*"){
                    if(!$find){                                          
                        $find=$true
                        $currentAction=1
                        $region = New-Object RegionItem -Property @{pos=$i;posType=0;action=1}
                        $posList+=$region
                    }else{
                        Write-Host "##### ERROR FIND Region TAG! #####"
                    }
                }
            }else{
                if($fullText[$i+1].Trim() -ne "/*"){
                    if(!$find){                    
                        $find=$true      
                        $currentAction=0               
                        $region = New-Object RegionItem -Property @{pos=$i;posType=0;action=0}
                        $posList+=$region
                    }else{
                        Write-Host "##### ERROR FIND Region TAG! #####"
                    }
                }
            }
        }elseif($find -And ($item -eq "//endregion")){
            #Write-Host "found END [$i]: $item"
            if($currentAction -eq 0){            
                $region = New-Object RegionItem -Property @{pos=$i;posType=1;action=0}           
            }else{
                $region = New-Object RegionItem -Property @{pos=$i;posType=1;action=1}            
            }
            $find=$false
            $posList+=$region
        }       
    }
    if($find){
        Write-Host "##### ERROR FIND TAG! #####"
    }

    if($debug){
        foreach($item in $posList){
            Write-Host  $item.pos,$item.posType, $item.action
        }
    }

    #Write-Host $posList.Length

    $j=0;
    for($i=0; $i -lt $fullText.Length;$i++){
        $item = $posList[$j];   
        if($i -eq $item.pos){
            if($item.action -eq 0){
                if($item.posType -eq 0){
                    $result += $fullText[$i]  
                    #$result += [System.Environment]::NewLine
                    $result += "`t/*" 
                }else{
                    $result +=  "`t*/"
                    $result += $fullText[$i];
                }
            }else{       
                if($item.posType -eq 0){
                    $result+=$fullText[$i++]                        
                }else{
                    $result[-1] =$fullText[$i]
                }
            }
            $j++;
        }else{
            $result+=$fullText[$i]
        }
    }

    if($debug){
        foreach($item in $result){
            Write-Host $item
        }
    }

    #$result | Out-File zz.java -encoding utf8
    if($posList.Length -gt 0){
        $Utf8NoBomEncoding = New-Object System.Text.UTF8Encoding $False
        [System.IO.File]::WriteAllLines($filePath, $result, $Utf8NoBomEncoding)
    }
}
#endregion

