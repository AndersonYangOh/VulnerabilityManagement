chcp 437
@echo off
cd /d %~1
IF EXIST classes-pg (
rmdir /s /q classes-pg
)

@echo - unzip pg
"C:\Program Files\7-Zip\7z.exe" x classes-pg.jar -o*

@echo - encrypt zz
java -cp ..\..\..\tools\VulinsightLib\shiro-tool-1.0-SNAPSHOT.jar; com.icgrtech.vulinsight.loader.ClassEncyptor ..\..\key.data classes-pg\com\bat\swp\web\exclude\zz1.class

java -cp ..\..\..\tools\VulinsightLib\shiro-tool-1.0-SNAPSHOT.jar; com.icgrtech.vulinsight.loader.ClassEncyptor ..\..\key.data classes\com\bat\swp\web\exclude\zz1.class

@echo - sign zz.class
java -cp ..\..\..\tools\VulinsightLib\shiro-tool-1.0-SNAPSHOT.jar;classes-pg com.icgrtech.signature.ClassSigner com/bat/swp/web/utils/zz.class classes-pg/app-code-config.xml 0

java -cp ..\..\..\tools\VulinsightLib\shiro-tool-1.0-SNAPSHOT.jar;classes com.icgrtech.signature.ClassSigner com/bat/swp/web/utils/zz.class classes/app-code-config.xml 0

@echo - sign BeanDefineConfigue.class
java -cp ..\..\..\tools\VulinsightLib\shiro-tool-1.0-SNAPSHOT.jar;classes-pg com.icgrtech.signature.ClassSigner com/bat/swp/web/controller/BeanDefineConfigue.class classes-pg/app-code-config.xml 1

java -cp ..\..\..\tools\VulinsightLib\shiro-tool-1.0-SNAPSHOT.jar;classes com.icgrtech.signature.ClassSigner com/bat/swp/web/controller/BeanDefineConfigue.class classes/app-code-config.xml 1

@echo - copy proguard class
rd /s /q com.bat.swp-web-0.0.1-SNAPSHOT\WEB-INF\classes
xcopy /s /i /y classes-pg\*.* com.bat.swp-web-0.0.1-SNAPSHOT\WEB-INF\classes\ >nul

@echo - build war file
del ROOT.war /q
cd com.bat.swp-web-0.0.1-SNAPSHOT
jar.exe cf ROOT.war .
move ROOT.war ..\
cd ..
